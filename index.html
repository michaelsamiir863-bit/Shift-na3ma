<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Close Shift1.8</title>
<style>
/* === ØªÙˆØ³ÙŠØ· Ø§Ù„Ù†ØµÙˆØµ ÙˆØ­Ø¯ÙˆØ¯ Ø³ÙˆØ¯Ø§Ø¡ === */
table, table td, table th{
  text-align:center;
  vertical-align:middle;
  border:1px solid #000;
  border-collapse:collapse;
}

:root{
  --main:#1e8f6f;
  --dark:#156b53;
  --bg:#f3f6f7;
  --card:#ffffff;
  --border:#ddd;
}

body{
  font-family:Tahoma;
  background:var(--bg);
  padding:12px;
}

.sheet{
  background:var(--card);
  max-width:390px;
  margin:auto;
  padding:14px;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}

table{
  width:100%;
  font-size:14px;
}

td{
  padding:8px 6px;
}
td:first-child{
  font-weight:bold;
  color:#444;
}

input,select,textarea{
  width:100%;
  border:none;
  outline:none;
  background:#f9f9f9;
  padding:7px;
  border-radius:6px;
  font-family:Tahoma;
  text-align:center;
}
textarea{resize:none}

.total{font-weight:bold;color:var(--main)}

button{
  border:none;
  background:var(--main);
  color:#fff;
  padding:6px 14px;
  border-radius:18px;
  cursor:pointer;
  font-size:13px;
}
button.secondary{background:#777}

.actions{text-align:center;margin-top:12px}

/* ===== Popup ===== */
.popup{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  justify-content:center;
  align-items:center;
  z-index:3000;
}
.popup-box{
  background:#fff;
  width:90%;
  max-width:360px;
  padding:22px;
  border-radius:16px;
  box-shadow:0 12px 40px rgba(0,0,0,.3);
  text-align:center;
}
.popup-box h2{color:var(--main);text-align:center}
.popup-box label{display:block;margin:6px 0;font-size:14px}

/* ===== Preview Ø¬Ø¯ÙˆÙ„ Ù…Ø¹ Ø¸Ù„ Ø§Ø­ØªØ±Ø§ÙÙŠ ===== */
#previewWrapper{
  max-width:390px;
  margin:auto;
  box-shadow:0 8px 25px rgba(0,0,0,0.15);
}

#previewWrapper table{
  width:100%;
  border-collapse:collapse;
}

#previewWrapper td{
  border:1px solid #000;
  padding:6px;
  text-align:center;
}

#previewWrapper img.logo{
  width:100%;
  height:auto;
  display:block;
  margin-bottom:10px;
}

@media print{
  @page{size:80mm auto;margin:0}
  body{background:#fff}
  .sheet,.popup,.actions,#previewWrapper{display:none!important}

  #printContent{
    display:block!important;
    width:80mm;
    transform:scale(.86);
    transform-origin:top left;
    margin-left:-5mm;
    font-size:12px;
    text-align:center;
  }
  #printContent table{
    width:100%;
    border-collapse:collapse;
  }
  #printContent td{
    border:1px solid #000;
    padding:4px;
    text-align:center;
  }
  #printContent img.logo{
    width:100%;
    height:auto;
    display:block;
    margin-bottom:10px;
  }
}
</style>
</head>
<body>

<!-- ===== Login ===== -->
<div class="popup" id="loginPopup">
  <div class="popup-box">
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <p>Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆØ¸Ù</p>
    <input id="empCode" type="number">
    <br><br>
    <button onclick="checkCode()">Ø¯Ø®ÙˆÙ„</button>
    <p id="loginError" style="color:red;text-align:center"></p>
  </div>
</div>

<!-- ===== Welcome / Checklist ===== -->
<div class="popup" id="startAlert">
  <div class="popup-box">
    <h2 id="welcomeText"></h2>
    <p style="font-weight:bold;margin-top:10px">ØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ§Ù„ÙŠ:</p>
    <label><input type="checkbox" class="checkItem"> ÙÙˆØ§ØªÙŠØ± Ø§Ù„ÙÙŠØ²Ø§</label>
    <label><input type="checkbox" class="checkItem"> Ø´Ø§Ø´Ø© Ø§Ù„ÙƒØ§Ø´ÙŠØ±</label>
    <label><input type="checkbox" class="checkItem"> Ø§Ù„Ø£Ø°ÙˆÙ† Ù…Ù† Ø§Ù„ÙØ±ÙˆØ¹</label>
    <label><input type="checkbox" class="checkItem"> Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø®Ù„ÙÙŠ</label>
    <br>
    <button id="confirmBtn" disabled
      style="opacity:.5;cursor:not-allowed"
      onclick="closeStartAlert()">ÙƒÙ„Ù‡ ØªÙ…Ø§Ù…</button>
  </div>
</div>

<div class="sheet">
<table>
<tr><td>Ø§Ù„ØªØ§Ø±ÙŠØ®</td><td><input type="date" id="date"></td></tr>
<tr><td>Ø§Ù„ÙŠÙˆÙ…</td><td><input id="day" readonly></td></tr>
<tr>
<td>Ø§Ù„Ø´ÙŠÙØª</td>
<td>
<select id="shift" onchange="updateShiftTime()">
<option value="">Ø§Ø®ØªØ±</option>
<option value="1">Ø´ÙŠÙØª 1</option>
<option value="2">Ø´ÙŠÙØª 2</option>
<option value="3">Ø´ÙŠÙØª 3</option>
<option value="4">Ø´ÙŠÙØª 4</option>
</select>
<div id="shiftTime" style="font-size:12px;color:#666"></div>
</td>
</tr>

<tr><td>Ù†Ù‚Ø¯ÙŠ</td><td><input id="cash"><button onclick="openCalc('cash')">ğŸ§®</button></td></tr>
<tr><td>Ø§Ù†Ø³ØªØ§Ø¨Ø§ÙŠ</td><td><input id="insta"><button onclick="openCalc('insta')">ğŸ§®</button></td></tr>
<tr><td>Ù…Ø­ÙØ¸Ø©</td><td><input id="wallet"><button onclick="openCalc('wallet')">ğŸ§®</button></td></tr>
<tr><td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø§Ø³Ø¨Ù‚</td><td><input id="total" class="total" readonly></td></tr>
<tr><td>ÙÙŠØ²Ø§</td><td><input id="visa"><button onclick="openCalc('visa')">ğŸ§®</button></td></tr>
<tr><td>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</td><td><input id="operations" readonly></td></tr>
<tr><td>Ù…Ø´ØªØ±ÙŠØ§Øª Ø£ÙØ±Ø§Ø¯</td><td><input id="individuals"></td></tr>
<tr><td>Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø¬</td><td><input id="responsible" readonly></td></tr>
<tr><td>Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹</td><td>
<select id="reviewer">
<option></option>
<option>Ø¯ Ù…Ø§ÙŠÙƒÙ„ Ø³Ù…ÙŠØ±</option>
<option>Ø¯ Ù‡Ø§Ù†ÙŠ Ø±Ø¶Ø§</option>
<option>Ø¯ Ù‡Ø¨Ù‡</option>
<option>Ø¯ Ø±Ø§Ø¹ÙˆØ«</option>
<option>Ø¯ ÙƒÙˆØ«Ø±</option>
<option>Ø¯ Ø§Ø³Ù„Ø§Ù…</option>
<option>Ø¯ Ø¨Ø³Ù†Øª</option>
</select>
</td></tr>

<tr id="notesRow" style="display:none">
<td>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</td>
<td><textarea id="notes"></textarea></td>
</tr>

</table>

<div class="actions">
<button onclick="toggleNotes()">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</button>
<button onclick="previewReceipt()">Ù…Ø¹Ø§ÙŠÙ†Ø©</button>
<button onclick="openPrintAlert()">Ø·Ø¨Ø§Ø¹Ø©</button>
</div>
</div>

<div id="previewWrapper" style="display:none"></div>
<div id="printContent" style="display:none"></div>

<!-- ===== Calculator ===== -->
<div class="popup" id="calcPopup">
  <div class="popup-box">
    <h2>Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø©</h2>
    <input id="calcExpr">
    <p id="calcResult">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ = 0</p>
    <button onclick="applyCalc()">Ø¥Ø¶Ø§ÙØ©</button>
    <button class="secondary" onclick="closeCalc()">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<!-- ===== Print Alert ===== -->
<div class="popup" id="printAlert">
  <div class="popup-box">
    <p style="text-align:center">
      ÙŠØ§ Ø¯ÙƒØªÙˆØ± <b id="alertResp"></b><br>
      Ù…ØªÙ†Ø³Ø§Ø´ ØªÙ‚ÙÙŠÙ„ Ø§Ù„Ø´ÙŠÙØª Ø¹Ù„ÙŠ Ø§Ù„Ø¬Ù‡Ø§Ø²
    </p>
    <button onclick="confirmPrint()">Ø·Ø¨Ø§Ø¹Ø©</button>
    <button class="secondary" onclick="closePrintAlert()">Ø±Ø¬ÙˆØ¹</button>
  </div>
</div>

<script>
const employees={
124:"Ø¯ Ù…Ø§ÙŠÙƒÙ„ Ø³Ù…ÙŠØ±",
109:"Ø¯ Ù‡Ø§Ù†ÙŠ Ø±Ø¶Ø§",
76:"Ø¯ Ù‡Ø¨Ù‡",
72:"Ø¯ Ø±Ø§Ø¹ÙˆØ«",
31:"Ø¯ ÙƒÙˆØ«Ø±",
159:"Ø¯ Ø§Ø³Ù„Ø§Ù…",
644:"Ø¯ Ø¨Ø³Ù†Øª"
};
window.onload=()=>loginPopup.style.display="flex";

function checkCode(){
  const code=empCode.value;
  if(employees[code]){
    responsible.value=employees[code];
    welcomeText.textContent="Ù‡Ù„Ù‹Ø§ ÙŠØ§ "+employees[code];
    loginPopup.style.display="none";
    startAlert.style.display="flex";
    enableChecklist();
  }else loginError.textContent="ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­";
}

function enableChecklist(){
  const checks=document.querySelectorAll(".checkItem");
  const btn=confirmBtn;
  checks.forEach(c=>{
    c.onchange=()=>{
      const ok=[...checks].every(i=>i.checked);
      btn.disabled=!ok;
      btn.style.opacity=ok?1:.5;
      btn.style.cursor=ok?"pointer":"not-allowed";
    }
  });
}

function closeStartAlert(){startAlert.style.display="none"}

date.onchange=()=>{
  let d=new Date(date.value);
  day.value=d.toLocaleDateString('ar-EG',{weekday:'long'});
};

function updateShiftTime(){
  const map={1:"Ù…Ù† 8 Ø¥Ù„Ù‰ 4",2:"Ù…Ù† 4 Ø¥Ù„Ù‰ 9",3:"Ù…Ù† 9 Ø¥Ù„Ù‰ 2",4:"Ù…Ù† 2 Ø¥Ù„Ù‰ 8"};
  shiftTime.textContent=map[shift.value]||"";
}

function calcTotal(){
  total.value=(+cash.value||0)+(+insta.value||0)+(+wallet.value||0);
}
cash.oninput=insta.oninput=wallet.oninput=calcTotal;

let currentField=null;
function openCalc(f){
  currentField=f;
  calcExpr.value="";
  calcResult.textContent="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ = 0";
  calcPopup.style.display="flex";
}
calcExpr.oninput=()=>{
  try{
    let r=eval(calcExpr.value);
    calcResult.textContent="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ = "+r;
    if(currentField==="visa")
      operations.value=calcExpr.value.split('+').filter(Boolean).length;
  }catch{}
}
function applyCalc(){
  let r=eval(calcExpr.value);
  document.getElementById(currentField).value=r;
  if(currentField!=="visa") calcTotal();
  closeCalc();
}
function closeCalc(){calcPopup.style.display="none"}

function toggleNotes(){
  notesRow.style.display=
    notesRow.style.display==="none"?"table-row":"none";
}

function previewReceipt(){
  previewWrapper.innerHTML=buildReceipt();
  previewWrapper.style.display="block";
}

function openPrintAlert(){
  if(!date.value||!shift.value) return;
  alertResp.textContent=responsible.value;
  printAlert.style.display="flex";
}
function closePrintAlert(){printAlert.style.display="none"}
function confirmPrint(){
  printAlert.style.display="none";
  printContent.innerHTML=buildReceipt();
  window.print();
}

function buildReceipt(){
return `
<table>
<tr><td colspan="2">
  <img class="logo"https://lh3.googleusercontent.com/pw/AP1GczN9HaBQy8vZHbdlUZch2YPbx4IEiea9q7MKoV6gPEeb-yVZjQADVQBYnV1nvdsf1XKZaGgVaePzIa6xu-lsmvn9Hx7yM3_nMgX44R_NfAg4JnTRxGbS7dgXpJYYziccaAid3HVYkBZcuk9XI_7zwbLA=w2400-h689-s-no-gm?authuser=0" alt="Logo">
</td></tr>
<tr><td>Ø§Ù„ØªØ§Ø±ÙŠØ®</td><td>${date.value}</td></tr>
<tr><td>Ø§Ù„ÙŠÙˆÙ…</td><td>${day.value}</td></tr>
<tr><td>Ø§Ù„Ø´ÙŠÙØª</td><td>${shiftTime.textContent}</td></tr>
<tr><td>Ù†Ù‚Ø¯ÙŠ</td><td>${cash.value}</td></tr>
<tr><td>Ø§Ù†Ø³ØªØ§Ø¨Ø§ÙŠ</td><td>${insta.value}</td></tr>
<tr><td>Ù…Ø­ÙØ¸Ø©</td><td>${wallet.value}</td></tr>
<tr><td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø§Ø³Ø¨Ù‚</td><td>${total.value}</td></tr>
<tr><td>ÙÙŠØ²Ø§</td><td>${visa.value}</td></tr>
<tr><td>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</td><td>${operations.value}</td></tr>
<tr><td>Ù…Ø´ØªØ±ÙŠØ§Øª Ø£ÙØ±Ø§Ø¯</td><td>${individuals.value}</td></tr>
<tr><td>Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø¬</td><td>${responsible.value}</td></tr>
<tr><td>Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹</td><td>${reviewer.value}</td></tr>
${notes.value?`<tr><td>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</td><td>${notes.value}</td></tr>`:""}
</table>`;
}
</script>

</body>
</html>
